<?xml version="1.0" encoding="utf-8"?>
<!-- © 2015 Grupo ESOC Ingeniería de Servicios, S.L.U. - Jairo Llopis
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl.html). -->

<openerp>
<data>

<record model="ir.ui.view" id="product_template_form_fields">
    <field name="name">Event products</field>
    <field name="model">product.template</field>
    <field name="inherit_id"
           ref="event_sale.event_sale_product_template_form"/>
    <field name="arch" type="xml">
        <xpath expr="//field[@name='event_type_id']" position="attributes">
            <attribute name="attrs">{
                "invisible": [("event_ok", "=", False),
                              ("is_event", "=", False)],
            }</attribute>
        </xpath>

        <xpath expr="//div[@name='options']">
            <field name="is_event"/>
            <label for="is_event"/>
        </xpath>
    </field>
</record>

<record model="ir.ui.view" id="product_template_form_button">
    <field name="name">Events for this product</field>
    <field name="model">product.template</field>
    <field name="inherit_id" ref="product.product_template_only_form_view"/>
    <field name="groups_id" eval="[(4, ref('event.group_event_user'))]"/>
    <field name="arch" type="xml">
        <xpath expr="//div[@name='buttons']" position="inside">
            <button class="oe_inline oe_stat_button"
                    name="action_view_events"
                    attrs="{
                        'invisible': [('is_event', '=', False)],
                    }"
                    context="{
                        'default_type': event_type_id,
                    }"
                    type="object"
                    icon="fa-calendar">
                <field name="event_count" widget="statinfo" />
            </button>
        </xpath>
    </field>
</record>

<record model="ir.ui.view" id="product_product_form_button">
    <field name="name">Events for this product</field>
    <field name="model">product.product</field>
    <field name="inherit_id" ref="product.product_normal_form_view"/>
    <field name="groups_id" eval="[(4, ref('event.group_event_user'))]"/>
    <field name="arch" type="xml">
        <xpath expr="//div[@name='buttons']" position="inside">
            <button class="oe_inline oe_stat_button"
                    name="action_view_events"
                    attrs="{
                        'invisible': [('is_event', '=', False)],
                    }"
                    context="{
                        'default_product_id': id,
                        'default_type': event_type_id,
                    }"
                    type="object"
                    icon="fa-calendar">
                <field name="event_count" widget="statinfo" />
            </button>
        </xpath>
    </field>
</record>

<record model="ir.ui.view" id="product_template_search">
    <field name="name">Search by event</field>
    <field name="model">product.template</field>
    <field name="inherit_id" ref="product.product_template_search_view"/>
    <field name="groups_id" eval="[(4, ref('event.group_event_user'))]"/>
    <field name="arch" type="xml">
        <xpath expr="/search">
            <filter string="Events" domain="[('is_event', '=', True)]"/>
        </xpath>

        <xpath expr="//group[@string='Group by...']">
            <filter string="Event type"
                    context="{'group_by': 'event_type_id'}"/>
        </xpath>
    </field>
</record>

</data>
</openerp>
